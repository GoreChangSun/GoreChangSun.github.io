<script src="https://balkan.app/js/OrgChart.js"></script>

<div background-color: #EBEBEB>
  <h1>Gore Mutual Insurance PX AI tool</h1>
</div>


<div id="tree"></div>


function importJSONHandler() {
    chart.importJSON();
}
function importXMLHandler() {
    chart.importXML();
}

function importCSVHandler() {
    chart.importCSV();
}

function pdfPreview(){
    chart.pdfPreviewUI.show({
        header: '<text>My Header</text>',
        footer: '<text>My Footer. Page {current-page} of {total-pages}</text>'
    });
}
function pngPreview(){
    chart.pngPreviewUI.show({
        header: '<text>My Header</text>',
        footer: '<text>My Footer. Page {current-page} of {total-pages}</text>'
    });
}

//JavaScript

let addButton = 
    '<svg xmlns="http://www.w3.org/2000/svg" x=10 y=10 width="20" height="20" viewBox="0 0 16 16"><path fill="#039BE5" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m7-4v3H4v2h3v3h2V9h3V7H9V4z"/></svg>';
let editButton = 
    '<svg xmlns="http://www.w3.org/2000/svg" x=40 y=10 width="20" height="20" viewBox="0 0 15 15"><path fill="#FFCA28" fill-rule="evenodd" d="M0 7.5a7.5 7.5 0 1 1 15 0a7.5 7.5 0 0 1-15 0Zm8.146-3.354a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708L6.707 11H4.5a.5.5 0 0 1-.5-.5V8.293l4.146-4.147Z" clip-rule="evenodd"/></svg>';

let deleteButton = 
    '<svg xmlns="http://www.w3.org/2000/svg" x=70 y=10 width="20" height="20" viewBox="0 0 16 16"><path fill="#F57C00" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-1.414l-2-2L4.586 6l2 2l-2 2L6 11.414l2-2l2 2L11.414 10l-2-2l2-2L10 4.586z"/></svg>';

OrgChart.templates.olivia.field_2 = addButton + '<rect data-add-button="{val}" x="10" y="10" rx="5" ry="5" fill="red" opacity="0" height="50" width="50"></rect> ';
OrgChart.templates.olivia.field_3 = editButton + '<rect data-edit-button="{val}" x="40" y="10" rx="5" ry="5" fill="red" opacity="0" height="50" width="50"></rect> ';
OrgChart.templates.olivia.field_4 = deleteButton + '<rect data-delete-button="{val}" x="70" y="10" rx="5" ry="5" fill="red" opacity="0" height="50" width="50"></rect> ';

  
var chart = new OrgChart(document.getElementById("tree"), {
      mouseScrool: OrgChart.action.none,
      template: "olivia",
      enableDragDrop: true,      
    menu: {
        xml_export: { text: "Export XML" },
        csv_export: { text: "Export CSV" },
        json_export: { text: "Export JSON" },   
        
          pdfPreview: {
        text: "Export PDF", 
        icon: OrgChart.icon.pdf(24, 24, "#7A7A7A"), 
        onClick: pdfPreview},
        pngPreview: {
        text: "Export PNG", 
        icon: OrgChart.icon.png(24, 24, "#7A7A7A"), 
        onClick: pngPreview},
            
        jsonImport: { text: "Import JSON", icon: OrgChart.icon.json(24, 24, 'red'), onClick: importJSONHandler },
        xmlImport: { text: "Import XML", icon: OrgChart.icon.xml(24, 24, 'red'), onClick: importXMLHandler },
        csvImport: { text: "Import CSV", icon: OrgChart.icon.csv(24, 24, 'red'), onClick: importCSVHandler }
    },
    
    nodeBinding: {
        field_0: "name",
        field_1: "title",
        img_0: "img",
        field_2: "id",
        field_3: "id",
        field_4: "id"
    },
    tags: {
        g: {
            template: "group"
        }
    },
    nodes: [
        { id: 1 },
        { id: 2, pid: 1, tags: ["g"] },
        { id: 3, pid: 1, tags: ["g"] },
        { id: 4, stpid: 2 },
        { id: 5, stpid: 2 },
        { id: 6, stpid: 3 },
        { id: 7, stpid: 3 }
    ]
});

chart.on('redraw', (sender) => {
    
    let addButtons = document.querySelectorAll('*[data-add-button]');
    addButtons.forEach(addButton => {
        addButton.addEventListener('click', (e) => {
            e.preventDefault();
            e.cancelBubble = true;
            chart.addNode({ id: chart.generateId(), pid: addButton.getAttribute('data-add-button')});
            return false;
        });
    });

    let editButtons = document.querySelectorAll('*[data-edit-button]');
    editButtons.forEach(editButton => {
        editButton.addEventListener('click', (e) => {
            e.preventDefault();
            e.cancelBubble = true;
            chart.editUI.show(editButton.getAttribute('data-edit-button'));
            return false;
        });
    });

    let removeButtons = document.querySelectorAll('*[data-delete-button]');
    removeButtons.forEach(removeButton => {
        removeButton.addEventListener('click', (e) => {
            e.preventDefault();
            e.cancelBubble = true;
            chart.removeNode(removeButton.getAttribute('data-delete-button'), null, true);
            return false;
        });
    });

});

chart.on('remove', (sender, nodeId) => {
    alert('Node ' + nodeId + ' is deleting...');
});


chart.load([
    { id: 1, name: "Amber McKenzie", title: "CEO" },
    { id: 2, pid: 1, name: "Ava Field", title: "HR" },
    { id: 3, pid: 1, name: "Peter Stevens", title: "Manager" }
])
  


